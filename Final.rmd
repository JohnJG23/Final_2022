---
title: "Covid91 vaccine study FinalFall2022"
author: "John Garza"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalFall2022.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

```{r}
Males_data <- filter(FinalData, sex == "M")
```

```{r}
barchartGC(~infected + treatment,data=Males_data)
barchartGC(~infected + treatment,data=Males_data , type="percent", main = ("Infected vs Treatment"))
```

Male cases from the unfortunate covid-19 epidemic can be visual representation's as just barplot's above. The blue bar's are the males who were given a plecebo or fake medications and the pink bar's are the males who were given a vaccine or an actual strong medication. At this moment we can describe that a man who does not receive a vaccine or strong medication has a very higher chance of becoming ill from covid-19. That is why the light blue bars are above the pink bar, where the y axis is approximately 70 percent. Though the next results over the x axis where it says ok are for males but who are not sick.

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Males_data)
rowPerc(table1)
colPerc(table1)
```

The male's numerical results displays the statistical results for an infected, ok, and vaccinated or not vaccinated male. On the fist table it reads that there are 68 males that are sick but are given a plecebo or fake medications out of 100 males and 32 males who were given a vaccine out of the 100 males. Then the table below has the results for the bottom table that are covid19(placebo) = 2.7, covid19(vaccine) = 1.2, OK(placebo) = 97.3, OK(vaccine) = 98.8. Men who take the vaccine are safer than men who did not.

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
malesfish <- fisher.test(table1)
malesfish
```

The information we are generally looking for here is the Fishers Exact test. In this scenario the test results read p-value = 2e-12, alternative hypothesis: true odds ratio is not equal to 1, 95 percent confidence interval: 1.7 2.8, sample estimates: odds ratio 2.2. Going from these results we can assume that there is no association between the effectiveness across the variety of sub populations tracked because we have not looked at the entire analysis. 


## Effectiveness Confidence Interval 'r low' to 'r hi'


```{r}
effect <- malesfish$p.value/(malesfish$p.value +1)
effectivenessmales = malesfish$estimate/(malesfish$estimate +1)*100
print(effectivenessmales)
```

```{r}
low=(malesfish$conf.int[1]/(malesfish$conf.int[1] +1))*100
hi=(malesfish$conf.int[2]/(malesfish$conf.int[2] +1))*100
options(digits=2)
```

In general, an odds ratio of 69 indicates a strong association. That is why on these male outcomes it appears to be that there is a significant association between effectiveness across males and vaccine. For example, in this males analysis the 95 percent confidence interval was 1.7 and 2.8 on the Fishers test and the Numerical results say males with the covid19 infection who got a placebo greatly outnumbered the males who recieved the vaccine 68 to 32 out of 100.  


## Females

```{r}
females_data <- filter(FinalData, sex == "F")
```

```{r}
barchartGC(~infected + treatment,data=females_data)
barchartGC(~infected + treatment,data=females_data , type="percent", main = ("Infected vs Treatment"))
```

Female cases from the unfortunate covid19 epidemic can be visual representation's as just barplot's above. The outcome for females is different than the males barchart, but there is still a group of females who are sick and one group who are ok, and still the blue bar's are the females who were given a plecebo or fake medications and the pink bar's are the females who were given a vaccine or an actual strong medication.  

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=females_data)
rowPerc(table1)
colPerc(table1)
```

The female's numerical results displays the statistical results for an infected, ok, and vaccinated or not vaccinated female. On the fist table it reads that there are 43 females who went through a placebo effect and 57 females who were given a vaccine out of 100 females that are sick and 50 placebo:50 vaccine females who are ok. Then the table below has the scores for the bottom table that are covid19(placebo) = 1.7, covid19(vaccine) = 2.3, OK(placebo) = 98.3, OK(vaccine) = 2.3  

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
femalesfish <- fisher.test(table1)
femalesfish
```

Interestingly similar to the males results the information we are generally looking for here is the Fishers Exact test. In this scenario the test results read p-value = 0.005, alternative hypothesis: true odds ratio is not equal to 1, 95 percent confidence interval: 0.60 0.92, sample estimates: odds ratio 0.74, and going from these results we can assume that there is also no association between the effectiveness across the variety of sub populations tracked, but there is differences between the female and the male results. The vaccine was not as effective as it was for males in the females analysis. 

## Effectiveness Confidence Interval 'r low' to 'r hi'


```{r}
effect <- femalesfish$p.value/(femalesfish$p.value +1)
effectivenessfemales = femalesfish$estimate/(femalesfish$estimate +1)*100
print(effectivenessfemales)
```

```{r}
low=(femalesfish$conf.int[1]/(femalesfish$conf.int[1] +1))*100
hi=(femalesfish$conf.int[2]/(femalesfish$conf.int[2] +1))*100
options(digits=2)
```

In general, an odds ratio indicates a strong association. Since this number is smaller than the males odds then there is a possibility that the vaccine is not effective for females. That is why it appears to be that there is a significant association between effectiveness across the covid-19 virus. For example, in the females automated generated responses the analysis results have gone to prove that we don't have an effective association like the males data.    

## LGBTQ

```{r}
LGBTQ_data <- filter(FinalData, LGBTQ == "gay")
```

```{r}
barchartGC(~infected + treatment,data=LGBTQ_data)
barchartGC(~infected + treatment,data=LGBTQ_data , type="percent", main = ("Infected vs Treatment"))
```

The barplot above here shows the percent of LGBTQ individuals who were infected with covid19 and who were OK. The pink bars are people who received the vaccine and the blue bars are the people who received the placebo. In this barchart there was a significantly higher reported number of covid19 patients who received a vaccine over the covid19 patients who received a placebo and then there was a slightly bigger number of reported patients who are OK but received a vaccine over ones who were OK and received the placebo.  

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=LGBTQ_data)
rowPerc(table1)
colPerc(table1)
```

The LGBTQ numerical results displays the statistical results for an infected, ok, and vaccinated or not vaccinated LGBTQ person. On the fist table it reads that there are 13 people who went through a placebo effect and 87 people who were given a vaccine out of 100 people that are sick and 49 placebo and 51 vaccine people who are OK. Then the table below has the results for the bottom table that are covid19(placebo) = 0.54, covid19(vaccine) = 3.3, OK(placebo) = 99.46, and OK(vaccine) = 96.7.

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
LGBTQfish <- fisher.test(table1)
LGBTQfish
```    

## Effectiveness Confidence Interval 'r low' to 'r hi'


```{r}
effect <- LGBTQfish$p.value/(LGBTQfish$p.value +1)
effectivenessLGBTQ = LGBTQfish$estimate/(LGBTQfish$estimate +1)*100
print(effectivenessLGBTQ)
```

```{r}
low=(LGBTQfish$conf.int[1]/(LGBTQfish$conf.int[1] +1))*100
hi=(LGBTQfish$conf.int[2]/(LGBTQfish$conf.int[2] +1))*100
options(digits=2)
```

## Druggies

```{r}
druggies_data <- filter(FinalData, DrugUser == "yes")
```

```{r}
barchartGC(~infected + treatment,data=druggies_data)
barchartGC(~infected + treatment,data=druggies_data , type="percent", main = ("Infected vs Treatment"))
```

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=druggies_data)
rowPerc(table1)
colPerc(table1)
```

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
druggiesfish <- fisher.test(table1)
druggiesfish
```   

## Effectiveness Confidence Interval 'r low' to 'r hi'


```{r}
effect <- druggiesfish$p.value/(druggiesfish$p.value +1)
effectivenessdruggies = druggiesfish$estimate/(druggiesfish$estimate +1)*100
print(effectivenessdruggies)
```

```{r}
low=(druggiesfish$conf.int[1]/(druggiesfish$conf.int[1] +1))*100
hi=(druggiesfish$conf.int[2]/(druggiesfish$conf.int[2] +1))*100
options(digits=2)
```



# Overall Results and Conclusions